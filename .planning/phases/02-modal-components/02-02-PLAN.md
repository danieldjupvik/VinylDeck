---
phase: 02-modal-components
plan: 02
type: execute
wave: 2
depends_on: ['02-01']
files_modified:
  - src/components/changelog/changelog-modal.tsx
  - src/components/changelog/changelog-content.tsx
  - src/components/changelog/changelog-entry.tsx
autonomous: true

must_haves:
  truths:
    - 'Modal renders as Dialog when viewport >= 768px'
    - 'Modal renders as Drawer when viewport < 768px'
    - 'Modal dismisses via X button click'
    - 'Modal dismisses via Escape key press'
    - 'Modal dismisses via backdrop click'
    - "Header displays version in format 'What's New in v{version}'"
    - 'Categories display with colored badge and icon'
    - 'Entries render as bullet list under category headings'
    - "Long entries truncate with 'Show more' button"
  artifacts:
    - path: 'src/components/changelog/changelog-modal.tsx'
      provides: 'Responsive modal wrapper'
      exports: ['ChangelogModal']
      min_lines: 50
    - path: 'src/components/changelog/changelog-content.tsx'
      provides: 'Modal content with header, categories, footer'
      exports: ['ChangelogContent']
      min_lines: 80
    - path: 'src/components/changelog/changelog-entry.tsx'
      provides: 'Single entry with truncation'
      exports: ['ChangelogEntry']
      min_lines: 30
  key_links:
    - from: 'src/components/changelog/changelog-modal.tsx'
      to: 'useIsMobile'
      via: 'conditional Dialog/Drawer rendering'
      pattern: 'useIsMobile'
    - from: 'src/components/changelog/changelog-content.tsx'
      to: 'Badge'
      via: 'category badge rendering'
      pattern: 'Badge.*variant'
    - from: 'src/components/changelog/changelog-content.tsx'
      to: 'formatChangelogDate'
      via: 'date display'
      pattern: 'formatChangelogDate'
---

<objective>
Create the responsive changelog modal and its content components.

Purpose: Build the core UI that users will see - a modal that adapts to screen size, displays version info, and shows categorized changelog entries.

Output: Three changelog components - the responsive modal wrapper, the content layout, and the truncatable entry component.
</objective>

<execution_context>
@/Users/danieldjupvik/.claude/get-shit-done/workflows/execute-plan.md
@/Users/danieldjupvik/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-modal-components/02-RESEARCH.md
@.planning/phases/02-modal-components/02-CONTEXT.md
@.planning/phases/02-modal-components/02-01-SUMMARY.md

@src/hooks/use-mobile.ts
@src/components/ui/dialog.tsx
@src/components/ui/drawer.tsx
@src/components/ui/badge.tsx
@src/components/ui/button.tsx
@src/lib/date-format.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create responsive changelog modal wrapper</name>
  <files>src/components/changelog/changelog-modal.tsx</files>
  <action>
Create the responsive modal component that switches between Dialog (desktop) and Drawer (mobile).

Requirements:

1. Use `useIsMobile()` hook from `@/hooks/use-mobile` (768px breakpoint)
2. Accept `open: boolean` and `onOpenChange: (open: boolean) => void` props
3. Render Dialog on desktop, Drawer on mobile
4. Pass children through for content rendering
5. Do NOT mount both Dialog AND Drawer - use conditional rendering

Component structure:

```typescript
interface ChangelogModalProps {
  open: boolean
  onOpenChange: (open: boolean) => void
  children: React.ReactNode
}
```

Follow the responsive pattern from RESEARCH.md:

- On mobile (isMobile === true): Render Drawer with DrawerContent
- On desktop (isMobile === false): Render Dialog with DialogContent

Key details:

- Dialog needs `max-w-lg` for reasonable width
- Drawer uses default bottom-up animation from vaul
- Both inherit dismissal behaviors (X button, Escape, backdrop) from Radix primitives
- Include TSDoc documentation per project conventions

Do NOT include header/footer in this component - those go in ChangelogContent.
</action>
<verify>

```bash
# Verify file exists
ls -la src/components/changelog/changelog-modal.tsx

# Verify useIsMobile import
grep "useIsMobile" src/components/changelog/changelog-modal.tsx

# Verify both Dialog and Drawer imports
grep -E "from.*dialog|from.*drawer" src/components/changelog/changelog-modal.tsx

# Verify conditional rendering pattern
grep -E "if.*isMobile|isMobile.*\?" src/components/changelog/changelog-modal.tsx

# Type check
bun run build 2>&1 | head -20
```

  </verify>
  <done>
ChangelogModal component created with responsive Dialog/Drawer rendering. Uses useIsMobile hook, accepts open/onOpenChange/children props, renders Dialog on desktop and Drawer on mobile.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create changelog content component with header, categories, and footer</name>
  <files>src/components/changelog/changelog-content.tsx</files>
  <action>
Create the shared content component that renders inside both Dialog and Drawer.

Requirements:

1. Accept version data as props (version string, date, categorized entries)
2. Render header with "What's New in v{version}" title
3. Show formatted date below header using formatChangelogDate utility
4. Group entries by category (features, fixes, improvements)
5. Render category badges with icons using the extended Badge variants
6. Render "Got it" dismiss button in footer

Props interface:

```typescript
interface ChangelogContentProps {
  version: string
  date: string
  entries: {
    features?: string[]
    fixes?: string[]
    improvements?: string[]
  }
  onDismiss: () => void
}
```

Category configuration (from RESEARCH.md):

- features: Sparkles icon, 'feature' variant, "New Features" label
- fixes: Bug icon, 'fix' variant, "Bug Fixes" label
- improvements: Zap icon, 'improvement' variant, "Improvements" label

Render each category only if it has entries. Order: features, improvements, fixes.

Layout:

- Header: title + date (use DialogHeader/DrawerHeader patterns)
- Body: scrollable area with category sections
- Footer: "Got it" button (use Button component)

Include TSDoc. Use i18n translation keys for all user-visible text (we'll add actual translations in Plan 03).
</action>
<verify>

```bash
# Verify file exists
ls -la src/components/changelog/changelog-content.tsx

# Verify Badge and icon imports
grep -E "Badge|Sparkles|Bug|Zap" src/components/changelog/changelog-content.tsx

# Verify formatChangelogDate usage
grep "formatChangelogDate" src/components/changelog/changelog-content.tsx

# Verify category rendering
grep -E "features|fixes|improvements" src/components/changelog/changelog-content.tsx

# Verify dismiss button
grep -i "got it" src/components/changelog/changelog-content.tsx

# Type check
bun run build 2>&1 | head -20
```

  </verify>
  <done>
ChangelogContent component renders header with version + date, category sections with Badge + icon for each non-empty category, and "Got it" dismiss button. Uses formatChangelogDate, Badge variants, and Lucide icons.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create changelog entry component with truncation</name>
  <files>src/components/changelog/changelog-entry.tsx</files>
  <action>
Create a component for individual changelog entries that supports text truncation.

Requirements:

1. Accept `text: string` prop
2. Show truncated text (2 lines) by default using Tailwind `line-clamp-2`
3. Detect if text is actually truncated using scrollHeight vs clientHeight
4. Show "Show more" button only if text is truncated
5. Toggle between truncated and expanded states

Implementation pattern from RESEARCH.md:

```typescript
function ChangelogEntry({ text }: { text: string }) {
  const [isExpanded, setIsExpanded] = useState(false)
  const [isTruncated, setIsTruncated] = useState(false)
  const textRef = useRef<HTMLParagraphElement>(null)

  useLayoutEffect(() => {
    const element = textRef.current
    if (element) {
      setIsTruncated(element.scrollHeight > element.clientHeight)
    }
  }, [text])
  // ... render with line-clamp-2 when not expanded
}
```

Key details:

- Use `useLayoutEffect` (not useEffect) for accurate measurement before paint
- Apply `line-clamp-2` class when not expanded
- "Show more" / "Show less" toggle button
- Use `text-muted-foreground` for entry text, `text-primary` for button
- Include TSDoc documentation

This component will be used inside ChangelogContent for each entry in a category.
</action>
<verify>

```bash
# Verify file exists
ls -la src/components/changelog/changelog-entry.tsx

# Verify truncation detection
grep -E "useLayoutEffect|scrollHeight|clientHeight" src/components/changelog/changelog-entry.tsx

# Verify line-clamp
grep "line-clamp" src/components/changelog/changelog-entry.tsx

# Verify toggle state
grep -E "Show more|Show less|isExpanded" src/components/changelog/changelog-entry.tsx

# Type check
bun run build 2>&1 | head -20
```

  </verify>
  <done>
ChangelogEntry component implements text truncation with line-clamp-2, detects truncation via scrollHeight/clientHeight in useLayoutEffect, and shows "Show more"/"Show less" toggle only when text is actually truncated.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. ChangelogModal renders Dialog on desktop, Drawer on mobile
2. ChangelogContent displays version header, categories with badges, dismiss button
3. ChangelogEntry truncates long text with "Show more" toggle
4. `bun run build` passes
5. `bun run lint` passes (or only has pre-existing warnings)
   </verification>

<success_criteria>

- `<ChangelogModal open={true} onOpenChange={fn}>` renders responsive modal
- Modal dismisses via X, Escape, and backdrop (inherited from Radix)
- Header shows "What's New in v0.3.0" format
- Categories render with colored badges and icons
- Long entries show truncation with expand toggle
- No new TypeScript or lint errors
  </success_criteria>

<output>
After completion, create `.planning/phases/02-modal-components/02-02-SUMMARY.md`
</output>
