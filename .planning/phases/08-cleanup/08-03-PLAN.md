---
phase: 08-cleanup
plan: 03
type: execute
wave: 1
depends_on: []
files_modified: [src/server/discogs/errors.ts]
autonomous: true
gap_closure: true

must_haves:
  truths:
    - 'vercel build completes without TS2554 errors in errors.ts'
    - 'Error.cause is still preserved on DiscogsApiError and DiscogsAuthError instances'
  artifacts:
    - path: 'src/server/discogs/errors.ts'
      provides: 'Facade error classes compatible with Vercel serverless TS compilation'
      contains: 'this.cause'
  key_links:
    - from: 'src/server/discogs/errors.ts'
      to: 'src/server/trpc/error-mapper.ts'
      via: 'DiscogsApiError and DiscogsAuthError imports'
      pattern: 'DiscogsApiError|DiscogsAuthError'
---

<objective>
Fix vercel build TS2554 error in facade error classes.

Purpose: Vercel's serverless function compiler does not recognize the ES2022 2-argument Error constructor (`super(message, { cause })`). Both `DiscogsApiError` and `DiscogsAuthError` hit this at lines 18 and 37. The fix is to call `super(message)` with one arg, then assign `this.cause` manually.

Output: `src/server/discogs/errors.ts` passes both `bun run build` and `vercel build` without TS2554.
</objective>

<execution_context>
@/Users/danieldjupvik/.claude/get-shit-done/workflows/execute-plan.md
@/Users/danieldjupvik/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/server/discogs/errors.ts
@src/server/trpc/error-mapper.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix Error constructor to avoid 2-arg super call</name>
  <files>src/server/discogs/errors.ts</files>
  <action>
In both `DiscogsApiError` and `DiscogsAuthError`:

1. Change `super(message, { cause: options.cause })` to `super(message)`
2. Add `this.cause = options.cause` immediately after the `super(message)` call

The result for DiscogsApiError constructor body should be:

```
super(message)
this.name = 'DiscogsApiError'
this.cause = options.cause
this.statusCode = options.statusCode
this.originalError = options.cause
```

Same pattern for DiscogsAuthError.

Update the file-level TSDoc comment to reflect the change: remove "with ES2022 Error.cause" wording since we are manually assigning cause instead of using the ES2022 constructor overload. The cause property still works the same way at runtime.

Preserve: single quotes, no semicolons, no trailing commas, `.js` extension on re-export, all existing TSDoc on classes and the re-export.
</action>
<verify>
Run `bun run build` — must pass with no errors.
Run `vercel build` — must pass with no TS2554 errors in errors.ts.
Verify cause is still set: grep for `this.cause` in errors.ts — should appear twice (once per class).
</verify>
<done>Both `DiscogsApiError` and `DiscogsAuthError` use single-arg super() with manual cause assignment. `vercel build` passes clean.</done>
</task>

</tasks>

<verification>
1. `bun run build` succeeds (no TypeScript errors)
2. `vercel build` succeeds (no TS2554 on errors.ts lines 18/37)
3. `src/server/discogs/errors.ts` still exports DiscogsApiError, DiscogsAuthError, DiscogsRateLimitError
4. Error.cause is preserved via manual assignment (`this.cause = options.cause`)
</verification>

<success_criteria>

- vercel build completes without TS2554 errors in src/server/discogs/errors.ts
- Both error classes preserve the cause chain for debugging
- No other files modified (this is a targeted fix)
  </success_criteria>

<output>
After completion, create `.planning/phases/08-cleanup/08-03-SUMMARY.md`
</output>
