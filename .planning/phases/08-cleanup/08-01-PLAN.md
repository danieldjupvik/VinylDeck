---
phase: 08-cleanup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/api/rate-limiter.ts
  - src/types/discogs-legacy.ts
  - src/types/discogs/augment.ts
  - src/types/discogs/index.ts
  - src/lib/constants.ts
  - src/server/discogs/rate-state.ts
  - package.json
  - bun.lock
autonomous: true

must_haves:
  truths:
    - 'src/api/rate-limiter.ts no longer exists'
    - 'src/types/discogs-legacy.ts no longer exists'
    - 'src/types/discogs/augment.ts no longer exists'
    - 'RATE_LIMIT constant no longer exists in src/lib/constants.ts'
    - 'motion package is not in package.json'
    - 'No unused type re-exports in src/types/discogs/index.ts'
    - 'Build passes (bun run build)'
    - 'Lint passes (bun run lint)'
  artifacts:
    - path: 'src/server/discogs/rate-state.ts'
      provides: 'RATE_LIMIT constants inlined (moved from constants.ts)'
      contains: 'MAX_REQUESTS.*60'
    - path: 'src/types/discogs/index.ts'
      provides: 'Clean type barrel without augment import or unused exports'
    - path: 'src/lib/constants.ts'
      provides: 'Constants without RATE_LIMIT section'
  key_links:
    - from: 'src/server/discogs/rate-state.ts'
      to: 'RATE_LIMIT constants'
      via: 'local constant (no longer imported from constants.ts)'
      pattern: 'RATE_LIMIT'
---

<objective>
Remove all deprecated code from the v1.1 facade migration: dead files, orphaned types, unused dependencies, and stale eslint-disable comments.

Purpose: Complete the cleanup requirements (TYPE-06, CLEAN-02, CLEAN-03) by removing code that is no longer imported or needed after the Phase 4-7 migration.
Output: A clean codebase with zero dead migration artifacts and passing build+lint.
</objective>

<execution_context>
@/Users/danieldjupvik/.claude/get-shit-done/workflows/execute-plan.md
@/Users/danieldjupvik/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-cleanup/08-RESEARCH.md

@src/api/rate-limiter.ts
@src/types/discogs-legacy.ts
@src/types/discogs/augment.ts
@src/types/discogs/index.ts
@src/types/discogs/oauth.ts
@src/lib/constants.ts
@src/server/discogs/rate-state.ts
@package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Delete dead files and move RATE_LIMIT constants</name>
  <files>
    src/api/rate-limiter.ts
    src/types/discogs-legacy.ts
    src/types/discogs/augment.ts
    src/types/discogs/index.ts
    src/lib/constants.ts
    src/server/discogs/rate-state.ts
  </files>
  <action>
    1. Delete `src/api/rate-limiter.ts` entirely (213 lines, zero imports, has explicit "Phase 8 will remove this file" comment).

    2. Delete `src/types/discogs-legacy.ts` entirely (738 lines, zero imports anywhere in codebase -- old hand-written types fully replaced by `src/types/discogs/`).

    3. Delete `src/types/discogs/augment.ts` (dead stub -- does nothing, just `import 'discojs'` and `export {}`). Then remove the `import './augment.js'` line from `src/types/discogs/index.ts`.

    4. In `src/types/discogs/index.ts`:
       - Remove line 74 (the eslint-disable comment about "Types exported for use after migration in Task 3")
       - Remove line 75: `export type { RequestTokenResult, AccessTokenResult } from './oauth.js'` -- these types are only re-exported here, never imported by any consuming code. Keep `OAuthTokens` and `OAuthRequestTokens` re-exports (line 76) as they ARE consumed.

    5. Move `RATE_LIMIT` constants from `src/lib/constants.ts` into `src/server/discogs/rate-state.ts`:
       - In `rate-state.ts`: Replace `import { RATE_LIMIT } from '../../lib/constants.js'` with a local constant definition:
         ```typescript
         const RATE_LIMIT = {
           MAX_REQUESTS: 60,
           BUFFER: 5,
           WINDOW_MS: 60 * 1000
         } as const
         ```
       - In `constants.ts`: Remove the entire `RATE_LIMIT` export and its JSDoc comment block (lines 13-40). Keep THEME, COLLECTION, and CACHE_NAMES.

    6. Run a broad grep to confirm no remaining references to deleted files:
       - `grep -r "rate-limiter" src/` should return nothing
       - `grep -r "discogs-legacy" src/` should return nothing
       - `grep -r "augment" src/types/discogs/` should return nothing

  </action>
  <verify>
    Run `bun run build` -- must pass with no errors.
    Run `bun run lint` -- must pass with no errors.
    Grep for deleted file references returns zero results.
  </verify>
  <done>
    All dead files deleted. RATE_LIMIT inlined into rate-state.ts. No broken imports. Build and lint pass.
  </done>
</task>

<task type="auto">
  <name>Task 2: Remove unused dependency and run full orphan scan</name>
  <files>
    package.json
    bun.lock
  </files>
  <action>
    1. Remove `motion` from `package.json` dependencies (currently `"motion": "^12.26.2"`, zero imports in any source file). Run `bun install` to update lockfile.

    2. Run an orphan scan across the codebase for any other dead code not caught in Task 1:
       - Check for other unused dependencies in `package.json` by grepping for each non-obvious dependency in source files
       - Look for orphaned exports in `src/lib/`, `src/hooks/`, `src/types/` that are defined but never imported
       - Verify no `as any`, `as unknown as`, or untyped returns remain in tRPC routers (`src/server/trpc/routers/`)
       - Check for any other eslint-disable comments that reference "phase", "migration", or "temporary"

    3. Remove any dead code found in step 2. Do NOT remove exports that are used only in tests or re-exported through barrel files that may be consumed externally.

    4. Run `vercel build` as final verification -- this catches Vercel-specific compilation issues that `bun run build` misses.

  </action>
  <verify>
    `bun run build` passes.
    `bun run lint` passes.
    `vercel build` passes.
    `motion` is not in `package.json`.
  </verify>
  <done>
    No unused dependencies in package.json. No orphaned exports or dead code remain. All three build checks pass (bun build, lint, vercel build).
  </done>
</task>

</tasks>

<verification>
1. `bun run build` -- TypeScript + Vite compilation passes
2. `bun run lint` -- ESLint passes (including import-x/no-unused-modules)
3. `vercel build` -- Vercel serverless function compilation passes
4. `grep -r "rate-limiter" src/` -- zero results
5. `grep -r "discogs-legacy" src/` -- zero results
6. `grep -r "augment" src/types/discogs/` -- zero results
7. `grep "motion" package.json` -- zero results
</verification>

<success_criteria>

- All dead files removed (rate-limiter.ts, discogs-legacy.ts, augment.ts)
- RATE_LIMIT constants moved from constants.ts to rate-state.ts
- Unused type re-exports cleaned from index.ts
- motion dependency removed
- Full orphan scan completed with no remaining dead code
- All three build pipelines pass
  </success_criteria>

<output>
After completion, create `.planning/phases/08-cleanup/08-01-SUMMARY.md`
</output>
